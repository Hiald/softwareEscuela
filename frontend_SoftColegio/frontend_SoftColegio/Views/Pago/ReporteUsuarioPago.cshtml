<div class="container-fluid">

    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <h4 class="page-title text-center" style="font-size:25px">PAGOS REALIZADOS</h4>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-3">
                            <div class="form-group">
                                <label for="idCursog">Nombre Alumno</label>
                                <input type="text" class="form-control" id="NombreALumno">
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group">
                                <label for="idCursog">Curso</label>
                                <select class="form-control" name="widcurso" id="idCursog"></select>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group">
                                <label for="fi">Fecha inicio</label>
                                <input type="date" class="form-control" id="fi">
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-group">
                                <label for="ff">Fecha fin</label>
                                <input type="date" class="form-control" id="ff">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                             <button type="button" class="btn btn-success btn-rounded mb-3" id="btnBuscar">Buscar<i class="dripicons-search"></i></button>
                            @*<a href="" onclick="fn_ActualizarDatos();" class="btn btn-success mb-3" data-toggle="tooltip" data-placement="top" data-html="true" title="" id="btnActualizar" data-original-title="Actualiza y busca la información.">
                                Buscar&nbsp;<i class="mdi mdi-autorenew"></i>
                            </a>*@
                        </div>
                    </div>
                    <!-- end nav-->
                    <div class="tab-content">
                        <div class="tab-pane show active" id="basic-datatable-preview">
                            <table id="tblPago" class="table table-striped dt-responsive nowrap w-100">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">APELLIDO Y NOMBRES</th>
                                        <th style="text-align:center">CURSO</th>
                                        <th style="text-align:center">FECHA_PAGO</th>
                                        <th style="text-align:center">MONTO</th>
                                        <th style="text-align:center">MESES QUE PAGO</th>
                                        <th style="text-align:center">AÑO</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var GvalorIdCurso = 0;
    var fechainicial = "";
    var fechafinal = "";
    var usuario = "";
    $(document).ready(function () {
        fn_ListarCursoGeneral();
        
    //$('#tblPago').DataTable({
    //        responsive: "true",
    //        dom: 'Bfrtilp',
    //        buttons: [
    //            {
    //                extend: 'excelHtml5',
    //                text: '<i class="fas fa-file-excel"></i> ',
    //                titleAttr: 'Exportar a Excel',
    //                className: 'btn btn-success'
    //            },
    //            {
    //                extend: 'pdfHtml5',
    //                text: '<i class="fas fa-file-pdf"></i> ',
    //                titleAttr: 'Exportar a PDF',
    //                className: 'btn btn-danger'
    //            },
    //            {
    //                extend: 'print',
    //                text: '<i class="fa fa-print"></i> ',
    //                titleAttr: 'Imprimir',
    //                className: 'btn btn-info'
    //            },
    //        ]
    //    });
    });

    function fn_ListarCursoGeneral() {
        var inivelvalor = parseInt(1); //$('#idNivelg option:selected').attr('value');
        $('#idGradog').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/curso/ListarGrado",
            data: {
                "widnivel": parseInt(inivelvalor),
            },
            success: function (data) {
                if (data.aaData === "") {
                    alert("¡No hay datos, ¡intenta agregar algunos!");
                }
                $('#idGradog').append($("<option></option>")
                    .attr("value", "")
                    .text("Seleccione una opción"));
                $.each(data.aaData, function (index, value) {
                    $('#idGradog').append($("<option></option>")
                        .attr("value", value.idgrado)
                        .text(value.SnombreGrado));
                });
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function fn_ListarCursoGeneral() {
        var slcnivelg = $('#idNivelg option:selected').attr('value');
        var slcgradog = $('#idGradog option:selected').attr('value');
        var dtipousuario = $('#hddtipousuario').val();
        var idusuarioparam = $('#hddidusuario').val();

        $('#idCursog').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/clase/ListarClaseGestion",
            data: {
                "idgrado": parseInt(1), //slcgradog
                "idnivel": parseInt(1) //slcnivelg
            },
            success: function (data) {
                if (data.data === "") {
                    alert("¡No hay datos, ¡intenta agregar algunos!");
                }
                $('#idCursog').append($("<option></option>")
                    .attr("value", "0")
                    .text("Listar todo"));
                $.each(data, function (index, value) {
                    $('#idCursog').append($("<option></option>")
                        .attr("value", value.idcurso)
                        .text(value.Snombre));
                });
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function fn_listartabla() {        
        $('#tblPago').DataTable(
            {
                "ajax": {
                    "url": "/Pago/rptListarUsuarioPagos",
                    "type": "POST",
                    "datatype": "json",
                    "data": {
                        "wsusuario": usuario
                        , "wsfechaini": fechainicial
                        , "wsfechafin": fechafinal
                        , "widcurso": GvalorIdCurso
                    }
                },
                //"bServerSide": true,
                "bProcessing": true,
                "bDestroy": true,
                "language": {
                    "info": "",
                    "infoEmpty": "",
                    "infoFiltered": "",
                    "emptyTable": "No se encontraron registros",
                    "sZeroRecords": "No se encontraron registros.",
                    "processing": "Cargando. Por favor espere...",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Último",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "sLengthMenu": "Mostrando _MENU_ filas",
                    "sSearch": "Buscar:"
                },
                "columns": [
                    { "sName": "Snombres", "mDataProp": "Snombres" },
                    { "sName": "SnombreCurso", "mDataProp": "SnombreCurso" },
                    { "sName": "Sfecharegistro", "mDataProp": "Sfecharegistro" },
                    { "sName": "Dmonto", "mDataProp": "Dmonto" },
                    { "sName": "Imes", "mDataProp": "Imes" },
                    { "sName": "Ianio", "mDataProp": "Ianio" }
                ]//,
                //"aoColumnDefs":
                //    [
                //        {
                //            "mRender": function (data, type, row) {
                //                var strHtml = "<button class='btn btn-info' onclick='fnVerDetalle(" + row.idpago + ", " + row.idcurso + ", " + row.idusuario + ")' >Ver detalle</button>";
                //                return strHtml;
                //            },
                //            "sWidth": "5px",
                //            "sClass": "css-center",
                //            "bSort": false,
                //            "aTargets": [3]
                //        },
                //    ]
            });
    }

   $("#btnBuscar").click(function ()
   {
       GvalorIdCurso = $('#idCursog option:selected').attr('value');
       fechainicial = $('#fi').val();
       fechafinal = $('#ff').val();
       usuario = $('#NombreALumno').val();
       fn_listartabla();
   });

</script>
