@{
    /**/

    ViewBag.Title = "pago";
}

<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Contenido</a></li>
                    <li class="breadcrumb-item active">Gestion Pago</li>
                </ol>
            </div>
            <h4 class="page-title">MÓDULO PAGO</h4>
        </div>
    </div>
</div>

@*<div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <p class="text-muted font-14">
                        <button type="button" class="btn btn-success btn-rounded mb-3" data-toggle="modal" data-target="#modalClase">
                                <i class="mdi mdi-plus"></i>Agregar Pago
                            </button>
                    </p>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="idCursoFiltro">Curso</label>
                                <select class="form-control" id="idCursoFiltro"></select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="idMesFiltro">Mes</label>
                                <select class="form-control" id="idMesFiltro"></select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="idAnioFiltro">Año</label>
                                <select class="form-control" id="idAnioFiltro"></select>
                            </div>
                        </div>
                    </div>
                    <!-- end nav-->
                    <div class="tab-content">
                        <div class="tab-pane show active" id="basic-datatable-preview">
                            <table id="tblPago" class="table dt-responsive nowrap w-100">
                                <thead>
                                    <tr>
                                        <th>Curso</th>
                                        <th>Mes</th>
                                        <th>Año</th>
                                        <th>Monto</th>
                                        <th>Estado</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>

                            </table>
                        </div>
                        <!-- end preview code-->
                    </div>
                </div>
            </div>
        </div>
    </div>*@

<div class="card">
    <div class="card-body">

        @using (Html.BeginForm("RegistrarPago", "pago", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <div class="row">
                <input type="hidden" name="widpago" value="0" />
                <input type="hidden" name="widpagodetalle" value="0" />
                <input type="hidden" name="widusuario" value="@ViewBag.Gidusuario" />

                <div class="col-md-4">
                    <div class="form-group mb-3">
                        <label for="idNivel">Nivel</label>
                        <select class="form-control" name="widnivel" id="idNivel"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group mb-3">
                        <label for="idGrado">Grado</label>
                        <select class="form-control" name="widgrado" id="idGrado"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group mb-3">
                        <label for="idCurso">Curso</label>
                        <select class="form-control" name="widcurso" id="idCurso"></select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="txtnrooperacion">Nro de operación</label>
                        <input type="text" id="txtnrooperacion" name="woperacion"
                               class="form-control" placeholder="Número de Operación">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="slcmes">Mes de pago</label>
                        <select class="form-control" name="wmes" id="slcmes"></select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="slctipopago">Tipo de pago</label>
                        <select class="form-control" name="wtipopago" id="slctipopago">
                            <option value="0">Seleccionar</option>
                            <option value="1">Transferencia</option>
                            <option value="2">Efectivo</option>
                            <option value="3">Por agente</option>
                            <option value="4">Otro</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="slctipomoneda">Tipo de moneda</label>
                        <select class="form-control" name="wtipomoneda" id="slctipomoneda">
                            <option value="0">Seleccionar</option>
                            <option value="1">Soles</option>
                            <option value="2">Dólares</option>
                            <option value="3">Otro</option>
                        </select>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="form-group mb-3">
                        <label for="txtmonto">Monto</label>
                        <input type="text" id="txtmonto" name="wmonto"
                               class="form-control" placeholder="Número de Operación">
                    </div>
                </div>

                <div class="col-lg-4">
                    <label for="flImagen1">Imagen de comprobante</label>
                    <input type="file" name="FRutaImagenes"
                           id="flImagen1" accept="image/jpeg,image/jpg">
                </div>

                <div class="col-lg-4">
                    <label for="flImagen2">Imagen 2 de comprobante (opcional)</label>
                    <input type="file" name="FRutaImagenes"
                           id="flImagen2" accept="image/jpeg,image/jpg">
                </div>

                <div class="col-lg-12">
                    <div class="form-group mb-3">
                        <label for="example-textarea">Descripcion (opcional)</label>
                        <textarea class="form-control" name="wdescripcion"
                                  id="txtDescripcion" placeholder="Descripción..." rows="3"></textarea>
                    </div>
                </div>
                <input type="hidden" name="wanio" value="2021" />
                <input type="hidden" name="whora" value="0" />

                <input type="hidden" name="wfecha_ini_pago" value="" />
                <input type="hidden" name="wbestado" value="1" />
                <input type="hidden" name="wfr" value="" />
                <input type="hidden" name="wff" value="" />
            </div>
            <div class="row justify-content-center text-center">
                <button class="btn btn-success btn-shadow btn-sm" id="btnGuardar" type="submit">Guardar</button>
            </div>
        }
    </div>
</div>

<input type="hidden" value="@ViewBag.GrolUsuario" id="hddtipousuario" />
<input type="hidden" value="@ViewBag.Gidusuario" id="hddidusuario" />

<script>
    var GvalorIdCurso = 0;

    function fn_ListarNivel() {

        $('#idNivel').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/curso/ListarNivel",
            success: function (data) {
                if (data.aaData === "") {
                    alert("¡No hay niveles, intenta agregar algunos!");
                }
                $('#idNivel').append($("<option></option>")
                    .attr("value", "")
                    .text("Seleccione una opción"));
                $.each(data.aaData, function (index, value) {
                    $('#idNivel').append($("<option></option>")
                        .attr("value", value.idnivel)
                        .text(value.SnombreNivel));
                });

            },
            error: function (data) {
                console.log(data);
            }
        });

    }

    function fn_ListarMesPendiente() {
        var slcnivelg = $('#idNivel option:selected').attr('value');
        var slcgradog = $('#idGrado option:selected').attr('value');
        var slccursog = $('#idCurso option:selected').attr('value');
        var idusuarioparam = $('#hddidusuario').val();
        $('#slcmes').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/pago/ListarPagoPendiente",
            data: {
                "wsidusuario": parseInt(idusuarioparam),
                "wsidnivel": parseInt(slcnivelg),
                "wsidgrado": parseInt(slcgradog),
                "wsidcurso": parseInt(slccursog),
                "wsbactivo": 0,
            },
            success: function (data) {
                console.log(data);
                if (data.aaData.length === 0) {
                    $('#slcmes').append($("<option></option>").attr("value", 1).text("Enero"));
                    $('#slcmes').append($("<option></option>").attr("value", 2).text("Febrero"));
                    $('#slcmes').append($("<option></option>").attr("value", 3).text("Marzo"));
                    $('#slcmes').append($("<option></option>").attr("value", 4).text("Abril"));
                    $('#slcmes').append($("<option></option>").attr("value", 5).text("Mayo"));
                    $('#slcmes').append($("<option></option>").attr("value", 6).text("Junio"));
                    $('#slcmes').append($("<option></option>").attr("value", 7).text("Julio"));
                    $('#slcmes').append($("<option></option>").attr("value", 8).text("Agosto"));
                    $('#slcmes').append($("<option></option>").attr("value", 9).text("Septiembre"));
                    $('#slcmes').append($("<option></option>").attr("value", 10).text("Octubre"));
                    $('#slcmes').append($("<option></option>").attr("value", 11).text("Noviembre"));
                    $('#slcmes').append($("<option></option>").attr("value", 12).text("Diciembre"));
                }

                $.each(data.aaData, function (index, value) {
                    var valormes = "";

                    switch (value.Imes) {
                        case 1: valormes = "Enero"; break;
                        case 2: valormes = "Febrero"; break;
                        case 3: valormes = "Marzo"; break;
                        case 4: valormes = "Abril"; break;
                        case 5: valormes = "Mayo"; break;
                        case 6: valormes = "Junio"; break;
                        case 7: valormes = "Julio"; break;
                        case 8: valormes = "Agosto"; break;
                        case 9: valormes = "Septiembre"; break;
                        case 10: valormes = "Octubre"; break;
                        case 11: valormes = "Noviembre"; break;
                        case 12: valormes = "Diciembre"; break;
                    }

                    $('#slcmes').append($("<option></option>")
                        .attr("value", value.Imes)
                        .text(valormes));
                });

            },
            error: function (data) {
                console.log(data);
            }
        });


    }

    function fn_ListarGrado() {
        var inivelvalor = $('#idNivel option:selected').attr('value');
        $('#idGrado').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/curso/ListarGrado",
            data: {
                "widnivel": parseInt(inivelvalor),
            },
            success: function (data) {
                if (data.aaData === "") {
                    alert("¡No hay datos, ¡intenta agregar algunos!");
                }
                $('#idGrado').append($("<option></option>")
                    .attr("value", "")
                    .text("Seleccione una opción"));
                $.each(data.aaData, function (index, value) {
                    $('#idGrado').append($("<option></option>")
                        .attr("value", value.idgrado)
                        .text(value.SnombreGrado));
                });

            },
            error: function (data) {
                console.log(data);
            }
        });

    }

    function fn_ListarCurso() {
        var slcnivelg = $('#idNivel option:selected').attr('value');
        var slcgradog = $('#idGrado option:selected').attr('value');
        var dtipousuario = $('#hddtipousuario').val();
        var idusuarioparam = $('#hddidusuario').val();

        $('#idCurso').find('option').remove();
        $.ajax({
            type: "POST",
            url: "/clase/ListarClaseGestion",
            data: {
                "idgrado": parseInt(slcgradog),
                "idnivel": parseInt(slcnivelg)
            },
            success: function (data) {
                if (data.data === "") {
                    alert("¡No hay datos, ¡intenta agregar algunos!");
                }
                $('#idCurso').append($("<option></option>")
                    .attr("value", "0")
                    .text("Seleccione una opción"));
                $.each(data, function (index, value) {
                    $('#idCurso').append($("<option></option>")
                        .attr("value", value.idcurso)
                        .text(value.Snombre));
                });
            },
            error: function (data) {
                console.log(data);
            }
        });

    }

    $(document).ready(function () {
        fn_ListarNivel();

        $('#idNivel').on('change', function () {
            fn_ListarGrado();
        });

        $('#idGrado').on('change', function () {
            fn_ListarCurso();
        });

        $('#idCurso').on('change', function () {
            fn_ListarMesPendiente();
        });

        //fn_listartabla();
    });

</script>