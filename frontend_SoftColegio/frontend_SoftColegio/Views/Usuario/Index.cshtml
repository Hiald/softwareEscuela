<div class="container-fluid">

    <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <div class="page-title-right">
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item"><a href="javascript: void(0);">Hyper</a></li>
                        <li class="breadcrumb-item"><a href="javascript: void(0);">Forms</a></li>
                        <li class="breadcrumb-item active">Form Validation</li>
                    </ol>
                </div>
                <h4 class="page-title">USUARIOS</h4>
            </div>
        </div>
    </div>
    <!-- end page title -->

    <div class="tab-content">
        <div class="tab-pane show active" id="basic-datatable-preview">
            <table id="basic-datatable" class="table dt-responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>Nivel/Grado</th>
                        <th>Usuario</th>
                        <th>Nombres</th>
                        <th>Apellidos</th>
                        <th>Correo</th>
                        <th>Tipo de usuario</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <!-- end nav-->
                    <div class="tab-content">
                        <div class="tab-pane show active" id="input-types-preview">
                            <div class="row">
                                <div class="col-lg-6">
                                    <form id="frmUsuario">
                                        <div class="form-group mb-3">
                                            <label for="example-select">Nivel (Primaria / Secundaria)</label>
                                            <select class="form-control" id="idNivel">
                                                <option>Seleccionar</option>
                                                <option value="1">Primaria</option>
                                                <option value="2">Secundaria</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="example-select">Grado</label>
                                            <select class="form-control" id="idGrado">
                                                <option>Seleccionar</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="example-select">Sede</label>
                                            <select class="form-control" id="idSede">
                                                <option>Seleccionar</option>
                                                <option value="1">Principal</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="simpleinput">Nombres</label>
                                            <input type="text" id="idNombres" placeholder="Nombres" class="form-control">
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="simpleinput">Apellido Paterno</label>
                                            <input type="text" id="idApPaterno" placeholder="Apellido Paterno" class="form-control">
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="simpleinput">Apellido Materno</label>
                                            <input type="text" id="idApMaterno" placeholder="Apellido Materno" class="form-control">
                                        </div>
                                        <button id="btnAgregar" class="btn btn-primary" type="button">Agregar</button>
                                    </form>
                                </div> <!-- end col -->

                                <div class="col-lg-6">
                                    <form id="frm2">
                                        <div class="form-group mb-3">
                                            <label for="example-select">Tipo Usuario</label>
                                            <select class="form-control" id="idTipoUsuario">
                                                <option>Seleccionar</option>
                                                <option value="1">Administrador</option>
                                                <option value="2">Profesor</option>
                                                <option value="3">Alumno</option>
                                            </select>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="example-email">Usuario</label>
                                            <input type="text" id="idUsuario" name="example-email" class="form-control" placeholder="Usuario">
                                        </div>

                                        <div class="form-group mb-3">
                                            <label for="example-password">Contraseña</label>
                                            <input type="password" id="idContrasenia" class="form-control">
                                        </div>

                                    </form>
                                </div> <!-- end col -->
                            </div>
                            <!-- end row-->
                        </div> <!-- end preview-->
                        <!-- end preview-->
                    </div>
                    <!-- end tab-content-->

                </div>
                <!-- end card-body-->
            </div>
            <!-- end card-->
        </div>
    </div>
    <!-- end row -->

</div>

<script>
    $("#frmUsuario").submit(false);
    $('#frm2').submit(false);

    $("#btnAgregar").click(function () {
        var slcNivel = $('#idNivel option:selected').attr('value');
        var slcGrado = $('#idGrado option:selected').attr('value');
        var slcSede = $('#idSede option:selected').attr('value');
        var ipNombres = $('#idNombres').val();
        var ipApPaterno = $('#idApPaterno').val();
        var ipApMaterno = $('#idApMaterno').val();
        var slcTipoUsuario = $('#idTipoUsuario option:selected').attr('value');
        var ipUsuario = $('#idUsuario').val();
        var ipContrasenia = $('#idContrasenia').val();

        $.ajax({
            type: "POST",
            url: RutaPrincipal + 'Login/Crearusuario',
            data: {
                "widnivel": slcNivel,
                "widgrado": slcGrado,
                "widsede": slcSede,
                "wnombres": ipNombres,
                "wamaterno": ipApPaterno,
                "wapaterno": ipApMaterno,
                "wtipousuario": slcTipoUsuario,
                "wusuario": ipUsuario,
                "wclave": ipContrasenia
            },
            async: false,
            success: function (msg) {
                console.log(msg);
            },
            error: function (msg) {
                console.log(msg);
                //location.reload();
            },
            complete: function (data) {
                // si acabo de completar
            }
        });

    });



    $(document).ready(function () {

        $('#basic-datatable').dataTable({
            "responsive": {
                "details": true,
                "columnDefs": [
                    { "responsivePriority": 1 },
                    { "responsivePriority": 2 }
                ]
            },
            "bServerSide": true,
            "sAjaxSource": RutaPrincipal + 'Login/ListarUsuarioGestion',
            "bProcessing": true,
            "sPaginationType": "full_numbers",
            "bFilter": true,
            "bSort": false,
            "language": {
                "info": "",
                "infoEmpty": "",
                "infoFiltered": "",
                "emptyTable": "No se encontraron registros",
                "sZeroRecords": "No se encontraron registros.",
                "processing": "Cargando. Por favor espere...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Último",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "sSearch": "Buscar:"
            },
            "bLengthChange": false,
            "fnDrawCallback": function (oSettings) {
                //si esta cargando la data
            },
            "aoColumns": [
                {
                    "mData": "idnivel",
                    "sClass": "center",
                    "mRender": function (data, type, value) {
                        return value.idnivel + "/" + value.idgrado;
                    }
                },
                { "sName": "Susuario", "mDataProp": "Susuario" },
                { "sName": "Snombres", "mDataProp": "Snombres" },
                {
                    "mData": "SApellidoPaterno",
                    "sClass": "center",
                    "mRender": function (data, type, value) {
                        return value.SApellidoPaterno + " " + value.SApellidoMaterno;
                    }
                },
                { "sName": "Scorreo", "mDataProp": "Scorreo" },
                { "sName": "tipousuario", "mDataProp": "tipousuario" },
                {},
                {}
            ],
            "fnServerData": function (sSource, aoData, fnCallback, oSettings) {
                var sEcho = aoData[0].value;
                var iNroPagina = 1;
                var iCantMostrar = 1;

                var sParams = {
                    "usuario": "",
                    "tipousuario": 0
                };

                oSettings.jqXHR = fn_ArmadoAJAX(
                    sSource,
                    sParams,
                    function (result) {
                        fnCallback(result);
                    }, function (error) {
                        // mostrar si hay un error
                        console.log(error);
                    });
            }, "aoColumnDefs":
                [
                    {
                        "mRender": function (data, type, row) {
                            var strHtml = "<button class='btn btn-warning' onclick='' data-cat=\"" + row.pos_idnivel + "|" + "\" id='AcessEliminar' >Editar</button>";
                            return strHtml;
                        },
                        "sWidth": "5px",
                        "sClass": "css-center",
                        "bSort": false,
                        "aTargets": [6]
                    },
                    {
                        "mRender": function (data, type, row) {
                            var strHtml = "<button class='btn btn-danger' onclick='' data-cat=\"" + row.pos_idnivel + "|" + "\" id='AcessEliminar' >Eliminar</button>";
                            return strHtml;
                        },
                        "sWidth": "5px",
                        "sClass": "css-center",
                        "bSort": false,
                        "aTargets": [7]
                    }
                ]
        });

    });

</script>